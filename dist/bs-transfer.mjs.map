{"version":3,"file":"bs-transfer.mjs","sources":["../src/options.js","../node_modules/style-inject/dist/style-inject.es.js","../src/functions.js","../src/BsTransfer.js"],"sourcesContent":["export default {\r\n    tableOptions: {\r\n        classes: 'table table-bordered table-condensed table-hover',\r\n        escape: true,\r\n        clickToSelect: true,\r\n        search: true,\r\n        showSearchButton: true,\r\n        sidePagination: 'server',\r\n    },\r\n    upperOptions: {},\r\n    lowerOptions: {},\r\n};","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import $ from 'jquery';\r\nimport options from './options';\r\nimport template from './template.html';\r\nimport styles from './styles.css';\r\n\r\n\r\n/**\r\n * 初始化选项\r\n * @param {BsTransfer} instance\r\n * @param {object} opts\r\n */\r\nexport function initOptions(instance, opts) {\r\n    opts = $.extend(true, {}, options, opts);\r\n    if (opts.mutexFields instanceof Array) {\r\n        const [field0, field1] = opts.mutexFields;\r\n        if (field0 && !field1) opts.mutexFields[1] = field0;\r\n    }\r\n    opts.upperOptions = $.extend(true, {}, opts.tableOptions, opts.upperOptions);\r\n    opts.lowerOptions = $.extend(true, {}, opts.tableOptions, opts.lowerOptions);\r\n    if (!opts.upperOptions.toolbar) {\r\n        opts.upperOptions.toolbar = $('<b>可选</b>')[0];\r\n    }\r\n    if (!opts.lowerOptions.toolbar) {\r\n        opts.lowerOptions.toolbar = $('<b>已选</b>')[0];\r\n    }\r\n    instance.options = opts;\r\n}\r\n\r\n\r\n/**\r\n * 初始化穿梭框\r\n * @param {BsTransfer} instance\r\n * @param {string} id\r\n */\r\nexport function initTransfer(instance, id) {\r\n    const opts = instance.options;\r\n    const html = template.replace(/ID/g, id);\r\n    instance.$dom = $(html);\r\n    instance.$upper = instance.$dom.find(`.${id}__upper`);\r\n    instance.$lower = instance.$dom.find(`.${id}__lower`);\r\n    instance.$upperTable = instance.$upper.children('table');\r\n    instance.$lowerTable = instance.$lower.children('table');\r\n\r\n    // 初始化表格\r\n    let isInitialized = false;\r\n    // if (opts.mutexFields instanceof Array) {\r\n    //     isInitialized = initWithMutexFields(instance);\r\n    // }\r\n    if (!isInitialized) {\r\n        instance.upperTable(opts.upperOptions);\r\n        instance.lowerTable(opts.lowerOptions);\r\n    }\r\n\r\n    // 监听按钮点击事件\r\n    const $middle = instance.$dom.find(`.${id}__middle`);\r\n    if (typeof opts.toUpper === 'function') {\r\n        $middle.find('button:first').click(opts.toUpper);\r\n    }\r\n    if (typeof opts.toLower === 'function') {\r\n        $middle.find('button:last').click(opts.toLower);\r\n    }\r\n\r\n    // 挂载\r\n    const $el = $(opts.mountPoint);\r\n    instance.$dom.addClass($el.attr('class'));\r\n    $el.replaceWith(instance.$dom);\r\n\r\n    // 自适应高度\r\n    $(window).resize(rafThrottle(_ => instance.adjustHeight()));\r\n    waitForRender(_ => instance.adjustHeight());\r\n}\r\n\r\n\r\n/**\r\n * 利用`requestAnimationFrame`进行节流\r\n * @param {function} fn\r\n * @returns {function}\r\n */\r\nfunction rafThrottle(fn) {\r\n    let token = 0;\r\n    return function () {\r\n        if (token) return;\r\n        token = 1;      // 取得令牌\r\n        const ctx = this;\r\n        const args = arguments;\r\n        requestAnimationFrame(function () {\r\n            fn.apply(ctx, args);\r\n            token = 0;  // 释放令牌\r\n        });\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * 等待渲染\r\n * @param {function} fn \r\n */\r\nexport function waitForRender(fn) {\r\n    if (Promise) {\r\n        Promise.resolve().then(fn)\r\n    } else {\r\n        setTimeout(fn);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * 增加样式\r\n * @param {string} id \r\n */\r\nexport function appendStyles(id) {\r\n    let html = `<style class=\"ID\" type=\"text/css\">${styles}</style>`;\r\n    html = html.replace(/ID/g, id);\r\n    $(document.body).append(html);\r\n}\r\n\r\n\r\n/**\r\n * 带互斥字段时的初始化\r\n * @param {BsTransfer} instance\r\n * @returns {boolean}\r\n */\r\nfunction initWithMutexFields(instance) {\r\n    const opts = instance.options;\r\n    const upperColumns = opts.upperOptions.columns;\r\n    let i = 0, len = upperColumns.length;\r\n    for (; i < len; ++i) {\r\n        if (upperColumns[i].checkbox) break;\r\n    }\r\n    if (i >= len) return false;             // no checkbox\r\n\r\n    const ckColumn = upperColumns[i];\r\n    if (ckColumn.formatter) return false;   // `formatter` already exists\r\n\r\n    const [field0, field1] = opts.mutexFields;\r\n    let hasInitUpperTable = 0;\r\n    const afterLowerTableLoadSuccess = function () {\r\n        const data = {};\r\n        $.each(instance.lowerTable('getData'), function (_, item) {\r\n            data[ item[field1] ] = 1;\r\n        });\r\n        ckColumn.formatter = function (_, row) {\r\n            if (row[field0] in data) {\r\n                return {\r\n                    disabled: true,\r\n                    checked: false,\r\n                };\r\n            }\r\n        };\r\n        if (hasInitUpperTable) {\r\n            instance.upperTable('load', instance.upperTable('getData'));    // reload data\r\n        } else {\r\n            instance.upperTable(opts.upperOptions);                         // init upper table\r\n            hasInitUpperTable = 1;\r\n        }\r\n    };\r\n\r\n    if (typeof opts.lowerOptions.onLoadSuccess === 'function') {\r\n        const onLoadSuccess = opts.lowerOptions.onLoadSuccess;\r\n        opts.lowerOptions.onLoadSuccess = function () {\r\n            onLoadSuccess.apply(opts.lowerOptions, arguments);\r\n            afterLowerTableLoadSuccess();\r\n        };\r\n    } else {\r\n        opts.lowerOptions.onLoadSuccess = afterLowerTableLoadSuccess;\r\n    }\r\n    instance.lowerTable(opts.lowerOptions);\r\n    return true;\r\n}\r\n","import $ from 'jquery';\r\nimport options from './options';\r\nimport {\r\n    appendStyles,\r\n    initOptions,\r\n    initTransfer,\r\n    waitForRender,\r\n} from './functions';\r\n\r\n\r\nexport default class BsTransfer {\r\n    static id = 'BS_TRANSFER';\r\n    static defaultOptions = options;\r\n\r\n\r\n    options;\r\n    $dom;\r\n    $upper;\r\n    $lower;\r\n    $upperTable;\r\n    $lowerTable;\r\n\r\n\r\n    constructor(opts) {\r\n        if (!$(`style.${BsTransfer.id}`).length) {\r\n            appendStyles(BsTransfer.id);         // 添加样式\r\n        }\r\n        initOptions(this, opts);\r\n        initTransfer(this, BsTransfer.id);\r\n        if (typeof opts.afterRender === 'function') {\r\n            waitForRender(opts.afterRender);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 调用上层表格的方法\r\n     * @param  {...any} args \r\n     */\r\n    upperTable(...args) {\r\n        return this.$upperTable.bootstrapTable(...args);\r\n    }\r\n\r\n\r\n    /**\r\n     * 调用下层表格的方法\r\n     * @param  {...any} args \r\n     */\r\n    lowerTable(...args) {\r\n        return this.$lowerTable.bootstrapTable(...args);\r\n    }\r\n\r\n\r\n    /**\r\n     * 同时调用两个表格的方法\r\n     * @param  {...any} args \r\n     */\r\n    twoTables(...args) {\r\n        this.$upperTable.bootstrapTable(...args);\r\n        this.$lowerTable.bootstrapTable(...args);\r\n    }\r\n\r\n\r\n    /**\r\n     * 调整两个表格高度\r\n     */\r\n    adjustHeight() {\r\n        const height = this.$upper.height();\r\n        this.twoTables('resetView', {height});\r\n    }\r\n}\r\n"],"names":["tableOptions","classes","escape","clickToSelect","search","showSearchButton","sidePagination","upperOptions","lowerOptions","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","initOptions","instance","opts","$","extend","options","mutexFields","Array","field0","field1","toolbar","initTransfer","id","html","template","replace","$dom","$upper","find","$lower","$upperTable","children","$lowerTable","upperTable","lowerTable","$middle","toUpper","click","toLower","$el","mountPoint","addClass","attr","replaceWith","window","resize","rafThrottle","_","adjustHeight","waitForRender","fn","token","ctx","args","arguments","requestAnimationFrame","apply","Promise","resolve","then","setTimeout","appendStyles","styles","body","append","BsTransfer","constructor","length","afterRender","bootstrapTable","twoTables","height"],"mappings":"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"}