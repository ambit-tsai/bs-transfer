{"version":3,"file":"bs-transfer.min.js","sources":["../src/options.js","../src/functions.js","../node_modules/style-inject/dist/style-inject.es.js","../src/BsTransfer.js"],"sourcesContent":["export default {\r\n    tableOptions: {\r\n        classes: 'table table-bordered table-condensed table-hover',\r\n        escape: true,\r\n        clickToSelect: true,\r\n        search: true,\r\n        showSearchButton: true,\r\n        sidePagination: 'server',\r\n    },\r\n    upperOptions: {},\r\n    lowerOptions: {},\r\n};","import $ from 'jquery';\r\nimport options from './options';\r\nimport template from './template.html';\r\nimport styles from './styles.css';\r\n\r\n\r\n/**\r\n * 初始化选项\r\n * @param {BsTransfer} instance\r\n * @param {object} opts\r\n */\r\nexport function initOptions(instance, opts) {\r\n    opts = $.extend(true, {}, options, opts);\r\n    if (opts.mutexFields instanceof Array) {\r\n        const [field0, field1] = opts.mutexFields;\r\n        if (field0 && !field1) opts.mutexFields[1] = field0;\r\n    }\r\n    opts.upperOptions = $.extend(true, {}, opts.tableOptions, opts.upperOptions);\r\n    opts.lowerOptions = $.extend(true, {}, opts.tableOptions, opts.lowerOptions);\r\n    if (!opts.upperOptions.toolbar) {\r\n        opts.upperOptions.toolbar = $('<b>可选</b>')[0];\r\n    }\r\n    if (!opts.lowerOptions.toolbar) {\r\n        opts.lowerOptions.toolbar = $('<b>已选</b>')[0];\r\n    }\r\n    instance.options = opts;\r\n}\r\n\r\n\r\n/**\r\n * 初始化穿梭框\r\n * @param {BsTransfer} instance\r\n * @param {string} id\r\n */\r\nexport function initTransfer(instance, id) {\r\n    const opts = instance.options;\r\n    const html = template.replace(/ID/g, id);\r\n    instance.$dom = $(html);\r\n    instance.$upper = instance.$dom.find(`.${id}__upper`);\r\n    instance.$lower = instance.$dom.find(`.${id}__lower`);\r\n    instance.$upperTable = instance.$upper.children('table');\r\n    instance.$lowerTable = instance.$lower.children('table');\r\n\r\n    // 初始化表格\r\n    let isInitialized = false;\r\n    // if (opts.mutexFields instanceof Array) {\r\n    //     isInitialized = initWithMutexFields(instance);\r\n    // }\r\n    if (!isInitialized) {\r\n        instance.upperTable(opts.upperOptions);\r\n        instance.lowerTable(opts.lowerOptions);\r\n    }\r\n\r\n    // 监听按钮点击事件\r\n    const $middle = instance.$dom.find(`.${id}__middle`);\r\n    if (typeof opts.toUpper === 'function') {\r\n        $middle.find('button:first').click(opts.toUpper);\r\n    }\r\n    if (typeof opts.toLower === 'function') {\r\n        $middle.find('button:last').click(opts.toLower);\r\n    }\r\n\r\n    // 挂载\r\n    const $el = $(opts.mountPoint);\r\n    instance.$dom.addClass($el.attr('class'));\r\n    $el.replaceWith(instance.$dom);\r\n\r\n    // 自适应高度\r\n    $(window).resize(rafThrottle(_ => instance.adjustHeight()));\r\n    waitForRender(_ => instance.adjustHeight());\r\n}\r\n\r\n\r\n/**\r\n * 利用`requestAnimationFrame`进行节流\r\n * @param {function} fn\r\n * @returns {function}\r\n */\r\nfunction rafThrottle(fn) {\r\n    let token = 0;\r\n    return function () {\r\n        if (token) return;\r\n        token = 1;      // 取得令牌\r\n        const ctx = this;\r\n        const args = arguments;\r\n        requestAnimationFrame(function () {\r\n            fn.apply(ctx, args);\r\n            token = 0;  // 释放令牌\r\n        });\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * 等待渲染\r\n * @param {function} fn \r\n */\r\nexport function waitForRender(fn) {\r\n    if (Promise) {\r\n        Promise.resolve().then(fn)\r\n    } else {\r\n        setTimeout(fn);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * 增加样式\r\n * @param {string} id \r\n */\r\nexport function appendStyles(id) {\r\n    let html = `<style class=\"ID\" type=\"text/css\">${styles}</style>`;\r\n    html = html.replace(/ID/g, id);\r\n    $(document.body).append(html);\r\n}\r\n\r\n\r\n/**\r\n * 带互斥字段时的初始化\r\n * @param {BsTransfer} instance\r\n * @returns {boolean}\r\n */\r\nfunction initWithMutexFields(instance) {\r\n    const opts = instance.options;\r\n    const upperColumns = opts.upperOptions.columns;\r\n    let i = 0, len = upperColumns.length;\r\n    for (; i < len; ++i) {\r\n        if (upperColumns[i].checkbox) break;\r\n    }\r\n    if (i >= len) return false;             // no checkbox\r\n\r\n    const ckColumn = upperColumns[i];\r\n    if (ckColumn.formatter) return false;   // `formatter` already exists\r\n\r\n    const [field0, field1] = opts.mutexFields;\r\n    let hasInitUpperTable = 0;\r\n    const afterLowerTableLoadSuccess = function () {\r\n        const data = {};\r\n        $.each(instance.lowerTable('getData'), function (_, item) {\r\n            data[ item[field1] ] = 1;\r\n        });\r\n        ckColumn.formatter = function (_, row) {\r\n            if (row[field0] in data) {\r\n                return {\r\n                    disabled: true,\r\n                    checked: false,\r\n                };\r\n            }\r\n        };\r\n        if (hasInitUpperTable) {\r\n            instance.upperTable('load', instance.upperTable('getData'));    // reload data\r\n        } else {\r\n            instance.upperTable(opts.upperOptions);                         // init upper table\r\n            hasInitUpperTable = 1;\r\n        }\r\n    };\r\n\r\n    if (typeof opts.lowerOptions.onLoadSuccess === 'function') {\r\n        const onLoadSuccess = opts.lowerOptions.onLoadSuccess;\r\n        opts.lowerOptions.onLoadSuccess = function () {\r\n            onLoadSuccess.apply(opts.lowerOptions, arguments);\r\n            afterLowerTableLoadSuccess();\r\n        };\r\n    } else {\r\n        opts.lowerOptions.onLoadSuccess = afterLowerTableLoadSuccess;\r\n    }\r\n    instance.lowerTable(opts.lowerOptions);\r\n    return true;\r\n}\r\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import $ from 'jquery';\r\nimport options from './options';\r\nimport {\r\n    appendStyles,\r\n    initOptions,\r\n    initTransfer,\r\n    waitForRender,\r\n} from './functions';\r\n\r\n\r\nexport default class BsTransfer {\r\n    static id = 'BS_TRANSFER';\r\n    static defaultOptions = options;\r\n\r\n\r\n    options;\r\n    $dom;\r\n    $upper;\r\n    $lower;\r\n    $upperTable;\r\n    $lowerTable;\r\n\r\n\r\n    constructor(opts) {\r\n        if (!$(`style.${BsTransfer.id}`).length) {\r\n            appendStyles(BsTransfer.id);         // 添加样式\r\n        }\r\n        initOptions(this, opts);\r\n        initTransfer(this, BsTransfer.id);\r\n        if (typeof opts.afterRender === 'function') {\r\n            waitForRender(opts.afterRender);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 调用上层表格的方法\r\n     * @param  {...any} args \r\n     */\r\n    upperTable(...args) {\r\n        return this.$upperTable.bootstrapTable(...args);\r\n    }\r\n\r\n\r\n    /**\r\n     * 调用下层表格的方法\r\n     * @param  {...any} args \r\n     */\r\n    lowerTable(...args) {\r\n        return this.$lowerTable.bootstrapTable(...args);\r\n    }\r\n\r\n\r\n    /**\r\n     * 同时调用两个表格的方法\r\n     * @param  {...any} args \r\n     */\r\n    twoTables(...args) {\r\n        this.$upperTable.bootstrapTable(...args);\r\n        this.$lowerTable.bootstrapTable(...args);\r\n    }\r\n\r\n\r\n    /**\r\n     * 调整两个表格高度\r\n     */\r\n    adjustHeight() {\r\n        const height = this.$upper.height();\r\n        this.twoTables('resetView', {height});\r\n    }\r\n}\r\n"],"names":["tableOptions","classes","escape","clickToSelect","search","showSearchButton","sidePagination","upperOptions","lowerOptions","initTransfer","instance","id","opts","options","html","replace","$dom","$","$upper","find","$lower","$upperTable","children","$lowerTable","upperTable","lowerTable","$middle","toUpper","click","toLower","fn","token","$el","mountPoint","addClass","attr","replaceWith","window","resize","_","adjustHeight","ctx","this","args","arguments","requestAnimationFrame","apply","waitForRender","Promise","resolve","then","setTimeout","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","BsTransfer","length","styles","body","append","extend","mutexFields","Array","field0","field1","toolbar","initOptions","afterRender","bootstrapTable","height","twoTables"],"mappings":"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"}